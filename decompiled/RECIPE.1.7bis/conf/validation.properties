notification.XSD=%CONF%/XSD/20160906-recipe/notification.xsd
feedback.XSD=%CONF%/XSD/20160906-recipe/feedback.xsd
kmehr.XSD=%CONF%/XSD/xsd-kmehr-1.17.1/ehealth-kmehr/XSD/recipe_PP_kmehr_elements_1_17.xsd
singlemessage.XSD=%CONF%/XSD/smc-v2.0.1/single-message/maindoc/single-message-oa-1.0.xsd
return.registerdata.XSD=%CONF%/XSD/return-registerdata-to-softwarevendors-v20120822.xsd

#######################################################################################################################
######################    P0   ########################################################################################
#######################################################################################################################
##(:Kmehr versions supported: 1.17.1 (20160601):)
kmehr.assert.P0.1 = /kmehrmessage/header/standard/cd[@S='CD-STANDARD' and @SV='1.18' and (text()='20160601')];1;1

##(:2 header IDs must be present: first one with "S" attribute = ID-KMEHR; the second one with "S" attribute = LOCAL:)
kmehr.assert.P0.2 = /kmehrmessage/header/id;2
kmehr.assert.P0.3 = /kmehrmessage/header/id[1][@S='ID-KMEHR' and @SV='1.0'];1
kmehr.assert.P0.4 = /kmehrmessage/header/id[2][@S='LOCAL'];1

##(:Sender: At least 2 hcparty's: individual healthcareprovider (or hospital) and "application" (softwareprovider). Name or combination firstname + familyname should always be present:)
kmehr.assert.P0.5 = /kmehrmessage/header/sender/hcparty;2
kmehr.assert.P0.6 = /kmehrmessage/header/sender/hcparty/id[@S='ID-HCPARTY' and @SV='1.0'];1
kmehr.assert.P0.7 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and (text()='orghospital' or text()='persphysician' or text()='persmidwife' or text()='persdentist')];1
kmehr.assert.P0.8 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='application'];1
kmehr.assert.P0.9 = /kmehrmessage/header/sender/hcparty[name or familyname];1

##(:For sender "application"; both telephone and email need to be present; and cannot be empty:)
kmehr.assert.P0.10 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-ADDRESS' and @SV='1.1']/text();2
kmehr.assert.P0.11 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and @SV='1.0']/text();2
kmehr.assert.P0.12 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='phone'];1
kmehr.assert.P0.13 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='email'];1
kmehr.assert.P0.14 = /kmehrmessage/header/sender/hcparty[2]/telecom/telecomnumber[string-length(text())!=0];1

##(:Recipient: only 1 hcparty with recipe data:)
kmehr.assert.P0.15 = /kmehrmessage/header/recipient/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and text()='RECIPE'];1;1
kmehr.assert.P0.16 = /kmehrmessage/header/recipient/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='orgpublichealth'];1;1
kmehr.assert.P0.17 = /kmehrmessage/header/recipient/hcparty/name[text()='Recip-e'];1;1

##(:Folder: exactly 1 folder; with exactly 1 ID; with value "1":)
kmehr.assert.P0.18 = /kmehrmessage/folder/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1

##(:Patient: exactly 1 patient; with exactly 1 ID (= INSZ/NISS number in 11 positions):)
kmehr.assert.P0.19 = /kmehrmessage/folder/patient;1;1
kmehr.assert.P0.20 = /kmehrmessage/folder/patient/id;1;1
kmehr.assert.P0.21 = /kmehrmessage/folder/patient/id[@S='ID-PATIENT' and @SV='1.0' and (string-length(text())=11)];1;1

##(:Patient: presence of firstname; familyname; sex and birthdate:)
kmehr.assert.P0.22 = /kmehrmessage/folder/patient/firstname;1;1
kmehr.assert.P0.23 = /kmehrmessage/folder/patient/familyname;1;1
kmehr.assert.P0.24 = /kmehrmessage/folder/patient/birthdate/date;1;1
kmehr.assert.P0.25 = /kmehrmessage/folder/patient/sex/cd[@S='CD-SEX' and @SV='1.1'];1;1

##(:Transaction: Exactly 1 transaction; with 1 ID and 1 CD (CD-TRANSACTION with value pharmaceuticalprescription):)
kmehr.assert.P0.26 = /kmehrmessage/folder/transaction/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P0.27 = /kmehrmessage/folder/transaction/cd[@S='CD-TRANSACTION' and @SV='1.9' and text()='pharmaceuticalprescription'];1;1

##(:Author: Exactly 1 hcparty; with 1 ID (in 11 positions; starting with 1; 3 or 4) and 1 CD-HCPARTY (only allowed prescribers):)
kmehr.assert.P0.28 = /kmehrmessage/folder/transaction/author/hcparty;1;1
kmehr.assert.P0.29 = /kmehrmessage/folder/transaction/author/hcparty/id;1;1
kmehr.assert.P0.30 = /kmehrmessage/folder/transaction/author/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and string-length(text())=11];1;1
kmehr.assert.P0.31 = /kmehrmessage/folder/transaction/author/hcparty/cd;1;1
kmehr.assert.P0.32 = /kmehrmessage/folder/transaction/author/hcparty/cd[@S='CD-HCPARTY' and @SV= '1.9' and (text()='persphysician' or text()='persmidwife' or text()='persdentist')];1;1

#(:Author: presence of name or combination firstname + familyname; presence of address; presence of telephone number:)
kmehr.assert.P0.33 = /kmehrmessage/folder/transaction/author/hcparty[name or familyname];1
kmehr.assert.P0.34 = /kmehrmessage/folder/transaction/author/hcparty/address;1;1
kmehr.assert.P0.35 = /kmehrmessage/folder/transaction/author/hcparty/address/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P0.36 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P0.37 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-TELECOM' and @SV='1.0' and text()='phone'];1;1
kmehr.assert.P0.38 = /kmehrmessage/folder/transaction/author/hcparty/telecom/telecomnumber[string-length(text())>1];1;1

#(:Transaction: "iscomplete" and "isvalidated" are both true; no expirationdate should be defined:)
kmehr.assert.P0.39 = /kmehrmessage/folder/transaction/iscomplete[text()='true'];1;1
kmehr.assert.P0.40 = /kmehrmessage/folder/transaction/isvalidated[text()='true'];1;1
kmehr.assert.P0.41 = /kmehrmessage/folder/transaction/expirationdate;0;0

#(:Transaction: contains exactly 1 heading; and cannot contain any items:)
kmehr.assert.P0.42 = /kmehrmessage/folder/transaction/heading;1;1
kmehr.assert.P0.43 = /kmehrmessage/folder/transaction/item;0;0

#(:Heading: exactly 1 ID and 1 CD (CD-HEADING) with value 'prescription':)
kmehr.assert.P0.44 = /kmehrmessage/folder/transaction/heading/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P0.45 = /kmehrmessage/folder/transaction/heading/cd[@S='CD-HEADING' and @SV='1.2' and text()='prescription'];1;1

#(:Heading: cannot contain any other headings or text:)
kmehr.assert.P0.46 = /kmehrmessage/folder/transaction/heading/heading;0;0
kmehr.assert.P0.47 = /kmehrmessage/folder/transaction/heading/text;0;0

#(:Items: at least 1 and no more than 10; with correct ID en CD specifications:)
kmehr.assert.P0.48 = /kmehrmessage/folder/transaction/heading/item;1;10
kmehr.assert.P0.49 = /kmehrmessage/folder/transaction/heading/item/id[@S!='ID-KMEHR'];0;0
kmehr.assert.P0.50 = /kmehrmessage/folder/transaction/heading/item/id[@SV!='1.0'];0;0
kmehr.assert.P0.51 = /kmehrmessage/folder/transaction/heading/item/cd[@S!='CD-ITEM'];0;0
kmehr.assert.P0.52 = /kmehrmessage/folder/transaction/heading/item/cd[@SV!='1.9'];0;0
kmehr.assert.P0.53 = /kmehrmessage/folder/transaction/heading/item/cd[text()!='medication'];0;0

#(:Content: only once per item:)
## kmehr.assert.P0.66 = count(/kmehrmessage/folder/transaction/heading/item/content)=count(/kmehrmessage/folder/transaction/heading/item);1;1

#(:Medicinalproduct: should always contain intendedcd (CNK). In case no CNK is known; intendedcd equals '0000000'. SV attribute is WSSAMv2 (in case the webservice SAMv2 is used); otherwise it defaults to LOCALDB:)
kmehr.assert.P0.54 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@S!='CD-DRUG-CNK'];0;0
kmehr.assert.P0.60 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and @SV!='WSSAMv2'];0;0

#(:Medicinalproduct: if value of intendedcd (CNK) equals '0000000' (default value when no CNK is known); SV attribute always equals 'LOCALDB':)
kmehr.assert.P0.55 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and text()='0000000'];0;0

#(:Medicinalproduct: intendedname cannot be empty (a product name should always be provided):)
kmehr.assert.P0.56 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct (INN): correct use of attributes and intendedname should not be empty (a cluster description/name should always be provided):)
kmehr.assert.P0.57 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@S!='CD-INNCLUSTER'];0;0
kmehr.assert.P0.58 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@SV!='LOCALDB'];0;0
kmehr.assert.P0.59 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct: If substancecode/cd element contains the cluster code; duration should be specified; in order to let the pharmacist choose the correct package size for the intended treatment duration. In case the INN prescription is provided as text (value cd='0000000'; duration is optional:)
#(:Desactivated at 27/01/2017 based on feedback
kmehr.assert.P0.1.60 = count(kmehrmessage/folder/transaction/heading/item[(content/substanceproduct/intendedcd[text()!='0000000'])]/duration)
kmehr.assert.P0.2.60 = count(kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[text()!='0000000'])

#(:Compoundprescription: Formularyreference: at least 1 cd; including S attribute =CD-FORMULARYREFERENCE should be present:)
kmehr.assert.P0.1.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference/cd[@S='CD-FORMULARYREFERENCE' and @SV='1.0' and (@L='fr' or @L='nl') and (string-length(@DN)!=0) and (string-length(text())!=0) and (string-length(text())=7) and starts-with(text(),'05')])
kmehr.assert.P0.2.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference)

#(:Lifecycle: every item should contain a lifecycle element with cd and corresponding attributes. cd value = prescribed:)
kmehr.assert.P0.1.62 = count(/kmehrmessage/folder/transaction/heading/item/lifecycle/cd[@S='CD-LIFECYCLE' and @SV='1.7' and text()='prescribed'])
kmehr.assert.P0.2.62 = count(/kmehrmessage/folder/transaction/heading/item)

#(:Temporality: optional; but if present; correct usage of S and SV attributes:)
kmehr.assert.P0.63 = /kmehrmessage/folder/transaction/heading/item/temporality/cd[not (@S='CD-TEMPORALITY') or not(@SV='1.0')];0;0

#(:Quantity: if prescription contains a medicinalproduct or compoundprescription; quantity should be specified:)
kmehr.assert.P0.1.64 = count(/kmehrmessage/folder/transaction/heading/item[(content/compoundprescription)]/quantity)
kmehr.assert.P0.2.64 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription)
kmehr.assert.P0.1.65 = count(/kmehrmessage/folder/transaction/heading/item[(content/medicinalproduct)]/quantity)
kmehr.assert.P0.2.65 = count(/kmehrmessage/folder/transaction/heading/item/content/medicinalproduct)

#(:Quantity: If substancecode/cd element contains the cluster code; no quantity should be present (duration should be specified):)
kmehr.assert.P0.66 = /kmehrmessage/folder/transaction/heading/item[(quantity)]/content/substanceproduct/intendedcd[text()!='0000000'];0;0

#(:Posology: posology is a mandatory element; and should be encoded as text (it should exactly correspond to the posology as printed on the proof of electronic prescription). Supplementary a regimen can be specified according to Vitalink-specifications. In case a posology is not relevant; please use the string 'niet van toepassing' or 'pas d'application'. In case the posology is known by the patient (en thus there is no need to further specify it); please use the string 'usage connu' or 'gebruik gekend'.:)
kmehr.assert.P0.1.67 = count(/kmehrmessage/folder/transaction/heading/item/posology/text)
kmehr.assert.P0.2.67 = count(/kmehrmessage/folder/transaction/heading/item)
kmehr.assert.P0.68 = /kmehrmessage/folder/transaction/heading/item/posology/text[string-length(text())=0];0;0

#(:Vitalink Medication scheme rule:  Beginmoment should be present for every item::)
kmehr.assert.P0.1.69 = count(/kmehrmessage/folder/transaction/heading/item/beginmoment/date)
kmehr.assert.P0.2.69 = count(/kmehrmessage/folder/transaction/heading/item)
#(:Vitalink Medication scheme rule:  Frequency (optional); can only contain periodicity; with correct SV attribute (1.1); and cannot contain following values: UQ; US; UN; UX en UE:)
kmehr.assert.P0.70 = /kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[text()='UQ' or text()='US' or text()='UN' or text()='UX' or text()='UE'];0;0
kmehr.assert.P0.1.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[@S='CD-PERIODICITY' and @SV='1.1'])
kmehr.assert.P0.2.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency)

#######################################################################################################################
######################    P1   ########################################################################################
#######################################################################################################################
##(:Kmehr versions supported: 1.17.1 (20160601):)
kmehr.assert.P1.1 = /kmehrmessage/header/standard/cd[@S='CD-STANDARD' and @SV='1.18' and (text()='20160601')];1;1

##(:2 header IDs must be present: first one with "S" attribute = ID-KMEHR; the second one with "S" attribute = LOCAL:)
kmehr.assert.P1.2 = /kmehrmessage/header/id;2
kmehr.assert.P1.3 = /kmehrmessage/header/id[1][@S='ID-KMEHR' and @SV='1.0'];1
kmehr.assert.P1.4 = /kmehrmessage/header/id[2][@S='LOCAL'];1

##(:Sender: At least 2 hcparty's: individual healthcareprovider (or hospital) and "application" (softwareprovider). Name or combination firstname + familyname should always be present:)
kmehr.assert.P1.5 = /kmehrmessage/header/sender/hcparty;2
kmehr.assert.P1.6 = /kmehrmessage/header/sender/hcparty/id[@S='ID-HCPARTY' and @SV='1.0'];1
kmehr.assert.P1.7 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and (text()='orghospital' or text()='persphysician' or text()='persmidwife' or text()='persdentist')];1
kmehr.assert.P1.8 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='application'];1
kmehr.assert.P1.9 = /kmehrmessage/header/sender/hcparty[name or familyname];1

##(:For sender "application"; both telephone and email need to be present; and cannot be empty:)
kmehr.assert.P1.10 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-ADDRESS' and @SV='1.1']/text();2
kmehr.assert.P1.11 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and @SV='1.0']/text();2
kmehr.assert.P1.12 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='phone'];1
kmehr.assert.P1.13 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='email'];1
kmehr.assert.P1.14 = /kmehrmessage/header/sender/hcparty[2]/telecom/telecomnumber[string-length(text())!=0];1

##(:Recipient: only 1 hcparty with recipe data:)
kmehr.assert.P1.15 = /kmehrmessage/header/recipient/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and text()='RECIPE'];1;1
kmehr.assert.P1.16 = /kmehrmessage/header/recipient/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='orgpublichealth'];1;1
kmehr.assert.P1.17 = /kmehrmessage/header/recipient/hcparty/name[text()='Recip-e'];1;1

##(:Folder: exactly 1 folder; with exactly 1 ID; with value "1":)
kmehr.assert.P1.18 = /kmehrmessage/folder/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1

##(:Patient: exactly 1 patient; with exactly 1 ID (= INSZ/NISS number in 11 positions):)
kmehr.assert.P1.19 = /kmehrmessage/folder/patient;1;1
kmehr.assert.P1.20 = /kmehrmessage/folder/patient/id;1;1
kmehr.assert.P1.21 = /kmehrmessage/folder/patient/id[@S='ID-PATIENT' and @SV='1.0' and (string-length(text())=11)];1;1

##(:Patient: presence of firstname; familyname; sex and birthdate:)
kmehr.assert.P1.22 = /kmehrmessage/folder/patient/firstname;1;1
kmehr.assert.P1.23 = /kmehrmessage/folder/patient/familyname;1;1
kmehr.assert.P1.24 = /kmehrmessage/folder/patient/birthdate/date;1;1
kmehr.assert.P1.25 = /kmehrmessage/folder/patient/sex/cd[@S='CD-SEX' and @SV='1.1'];1;1

##(:Transaction: Exactly 1 transaction; with 1 ID and 1 CD (CD-TRANSACTION with value pharmaceuticalprescription):)
kmehr.assert.P1.26 = /kmehrmessage/folder/transaction/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P1.27 = /kmehrmessage/folder/transaction/cd[@S='CD-TRANSACTION' and @SV='1.9' and text()='pharmaceuticalprescription'];1;1

##(:Author: Exactly 1 hcparty; with 1 ID (in 11 positions; starting with 1; 3 or 4) and 1 CD-HCPARTY (only allowed prescribers):)
kmehr.assert.P1.28 = /kmehrmessage/folder/transaction/author/hcparty;1;1
kmehr.assert.P1.29 = /kmehrmessage/folder/transaction/author/hcparty/id;1;1
kmehr.assert.P1.30 = /kmehrmessage/folder/transaction/author/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and string-length(text())=11];1;1
kmehr.assert.P1.31 = /kmehrmessage/folder/transaction/author/hcparty/cd;1;1
kmehr.assert.P1.32 = /kmehrmessage/folder/transaction/author/hcparty/cd[@S='CD-HCPARTY' and @SV= '1.9' and (text()='persphysician' or text()='persmidwife' or text()='persdentist')];1;1

#(:Author: presence of name or combination firstname + familyname; presence of address; presence of telephone number:)
kmehr.assert.P1.33 = /kmehrmessage/folder/transaction/author/hcparty[name or familyname];1
kmehr.assert.P1.34 = /kmehrmessage/folder/transaction/author/hcparty/address;1;1
kmehr.assert.P1.35 = /kmehrmessage/folder/transaction/author/hcparty/address/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P1.36 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P1.37 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-TELECOM' and @SV='1.0' and text()='phone'];1;1
kmehr.assert.P1.38 = /kmehrmessage/folder/transaction/author/hcparty/telecom/telecomnumber[string-length(text())>1];1;1

#(:Transaction: "iscomplete" and "isvalidated" are both true; no expirationdate should be defined:)
kmehr.assert.P1.39 = /kmehrmessage/folder/transaction/iscomplete[text()='true'];1;1
kmehr.assert.P1.40 = /kmehrmessage/folder/transaction/isvalidated[text()='true'];1;1
kmehr.assert.P1.41 = /kmehrmessage/folder/transaction/expirationdate;0;0

#(:Transaction: contains exactly 1 heading; and cannot contain any items:)
kmehr.assert.P1.42 = /kmehrmessage/folder/transaction/heading;1;1
kmehr.assert.P1.43 = /kmehrmessage/folder/transaction/item;0;0

#(:Heading: exactly 1 ID and 1 CD (CD-HEADING) with value 'prescription':)
kmehr.assert.P1.44 = /kmehrmessage/folder/transaction/heading/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P1.45 = /kmehrmessage/folder/transaction/heading/cd[@S='CD-HEADING' and @SV='1.2' and text()='prescription'];1;1

#(:Heading: cannot contain any other headings or text:)
kmehr.assert.P1.46 = /kmehrmessage/folder/transaction/heading/heading;0;0
kmehr.assert.P1.47 = /kmehrmessage/folder/transaction/heading/text;0;0

#(:Items: at least 1 and no more than 10; with correct ID en CD specifications:)
kmehr.assert.P1.48 = /kmehrmessage/folder/transaction/heading/item;1;10
kmehr.assert.P1.49 = /kmehrmessage/folder/transaction/heading/item/id[@S!='ID-KMEHR'];0;0
kmehr.assert.P1.50 = /kmehrmessage/folder/transaction/heading/item/id[@SV!='1.0'];0;0
kmehr.assert.P1.51 = /kmehrmessage/folder/transaction/heading/item/cd[@S!='CD-ITEM'];0;0
kmehr.assert.P1.52 = /kmehrmessage/folder/transaction/heading/item/cd[@SV!='1.9'];0;0
kmehr.assert.P1.53 = /kmehrmessage/folder/transaction/heading/item/cd[text()!='medication'];0;0

#(:Content: only once per item:)
## kmehr.assert.P1.66 = count(/kmehrmessage/folder/transaction/heading/item/content)=count(/kmehrmessage/folder/transaction/heading/item);1;1

#(:Medicinalproduct: should always contain intendedcd (CNK). In case no CNK is known; intendedcd equals '0000000'. SV attribute is WSSAMv2 (in case the webservice SAMv2 is used); otherwise it defaults to LOCALDB:)
kmehr.assert.P1.54 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@S!='CD-DRUG-CNK'];0;0
kmehr.assert.P1.60 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and @SV!='WSSAMv2'];0;0

#(:Medicinalproduct: if value of intendedcd (CNK) equals '0000000' (default value when no CNK is known); SV attribute always equals 'LOCALDB':)
kmehr.assert.P1.55 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and text()='0000000'];0;0

#(:Medicinalproduct: intendedname cannot be empty (a product name should always be provided):)
kmehr.assert.P1.56 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct (INN): correct use of attributes and intendedname should not be empty (a cluster description/name should always be provided):)
kmehr.assert.P1.57 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@S!='CD-INNCLUSTER'];0;0
kmehr.assert.P1.58 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@SV!='LOCALDB'];0;0
kmehr.assert.P1.59 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct: If substancecode/cd element contains the cluster code; duration should be specified; in order to let the pharmacist choose the correct package size for the intended treatment duration. In case the INN prescription is provided as text (value cd='0000000'; duration is optional:)
#(:Desactivated at 27/01/2017 based on feedback
kmehr.assert.P1.1.60 = count(kmehrmessage/folder/transaction/heading/item[(content/substanceproduct/intendedcd[text()!='0000000'])]/duration)
kmehr.assert.P1.2.60 = count(kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[text()!='0000000'])

#(:Compoundprescription: Formularyreference: at least 1 cd; including S attribute =CD-FORMULARYREFERENCE should be present:)
kmehr.assert.P1.1.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference/cd[@S='CD-FORMULARYREFERENCE' and @SV='1.0' and (@L='fr' or @L='nl') and (string-length(@DN)!=0) and (string-length(text())!=0) and (string-length(text())=7) and starts-with(text(),'05')])
kmehr.assert.P1.2.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference)

#(:Lifecycle: every item should contain a lifecycle element with cd and corresponding attributes. cd value = prescribed:)
kmehr.assert.P1.1.62 = count(/kmehrmessage/folder/transaction/heading/item/lifecycle/cd[@S='CD-LIFECYCLE' and @SV='1.7' and text()='prescribed'])
kmehr.assert.P1.2.62 = count(/kmehrmessage/folder/transaction/heading/item)

#(:Temporality: optional; but if present; correct usage of S and SV attributes:)
kmehr.assert.P1.63 = /kmehrmessage/folder/transaction/heading/item/temporality/cd[not (@S='CD-TEMPORALITY') or not(@SV='1.0')];0;0

#(:Quantity: if prescription contains a medicinalproduct or compoundprescription; quantity should be specified:)
kmehr.assert.P1.1.64 = count(/kmehrmessage/folder/transaction/heading/item[(content/compoundprescription)]/quantity)
kmehr.assert.P1.2.64 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription)
kmehr.assert.P1.1.65 = count(/kmehrmessage/folder/transaction/heading/item[(content/medicinalproduct)]/quantity)
kmehr.assert.P1.2.65 = count(/kmehrmessage/folder/transaction/heading/item/content/medicinalproduct)

#(:Quantity: If substancecode/cd element contains the cluster code; no quantity should be present (duration should be specified):)
kmehr.assert.P1.66 = /kmehrmessage/folder/transaction/heading/item[(quantity)]/content/substanceproduct/intendedcd[text()!='0000000'];0;0

#(:Posology: posology is a mandatory element; and should be encoded as text (it should exactly correspond to the posology as printed on the proof of electronic prescription). Supplementary a regimen can be specified according to Vitalink-specifications. In case a posology is not relevant; please use the string 'niet van toepassing' or 'pas d'application'. In case the posology is known by the patient (en thus there is no need to further specify it); please use the string 'usage connu' or 'gebruik gekend'.:)
kmehr.assert.P1.1.67 = count(/kmehrmessage/folder/transaction/heading/item/posology/text)
kmehr.assert.P1.2.67 = count(/kmehrmessage/folder/transaction/heading/item)
kmehr.assert.P1.68 = /kmehrmessage/folder/transaction/heading/item/posology/text[string-length(text())=0];0;0

#(:Vitalink Medication scheme rule:  Beginmoment should be present for every item::)
kmehr.assert.P1.1.69 = count(/kmehrmessage/folder/transaction/heading/item/beginmoment/date)
kmehr.assert.P1.2.69 = count(/kmehrmessage/folder/transaction/heading/item)
#(:Vitalink Medication scheme rule:  Frequency (optional); can only contain periodicity; with correct SV attribute (1.1); and cannot contain following values: UQ; US; UN; UX en UE:)
kmehr.assert.P1.70 = /kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[text()='UQ' or text()='US' or text()='UN' or text()='UX' or text()='UE'];0;0
kmehr.assert.P1.1.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[@S='CD-PERIODICITY' and @SV='1.1'])
kmehr.assert.P1.2.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency)
#######################################################################################################################
######################    P2   ########################################################################################
#######################################################################################################################
##(:Kmehr versions supported: 1.17.1 (20160601):)
kmehr.assert.P2.1 = /kmehrmessage/header/standard/cd[@S='CD-STANDARD' and @SV='1.18' and (text()='20160601')];1;1

##(:2 header IDs must be present: first one with "S" attribute = ID-KMEHR; the second one with "S" attribute = LOCAL:)
kmehr.assert.P2.2 = /kmehrmessage/header/id;2
kmehr.assert.P2.3 = /kmehrmessage/header/id[1][@S='ID-KMEHR' and @SV='1.0'];1
kmehr.assert.P2.4 = /kmehrmessage/header/id[2][@S='LOCAL'];1

##(:Sender: At least 2 hcparty's: individual healthcareprovider (or hospital) and "application" (softwareprovider). Name or combination firstname + familyname should always be present:)
kmehr.assert.P2.5 = /kmehrmessage/header/sender/hcparty;2
kmehr.assert.P2.6 = /kmehrmessage/header/sender/hcparty/id[@S='ID-HCPARTY' and @SV='1.0'];1
kmehr.assert.P2.7 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and (text()='orghospital' or text()='persphysician' or text()='persmidwife' or text()='persdentist')];1
kmehr.assert.P2.8 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='application'];1
kmehr.assert.P2.9 = /kmehrmessage/header/sender/hcparty[name or familyname];1

##(:For sender "application"; both telephone and email need to be present; and cannot be empty:)
kmehr.assert.P2.10 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-ADDRESS' and @SV='1.1']/text();2
kmehr.assert.P2.11 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and @SV='1.0']/text();2
kmehr.assert.P2.12 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='phone'];1
kmehr.assert.P2.13 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='email'];1
kmehr.assert.P2.14 = /kmehrmessage/header/sender/hcparty[2]/telecom/telecomnumber[string-length(text())!=0];1

##(:Recipient: only 1 hcparty with recipe data:)
kmehr.assert.P2.15 = /kmehrmessage/header/recipient/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and text()='RECIPE'];1;1
kmehr.assert.P2.16 = /kmehrmessage/header/recipient/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='orgpublichealth'];1;1
kmehr.assert.P2.17 = /kmehrmessage/header/recipient/hcparty/name[text()='Recip-e'];1;1

##(:Folder: exactly 1 folder; with exactly 1 ID; with value "1":)
kmehr.assert.P2.18 = /kmehrmessage/folder/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1

##(:Patient: exactly 1 patient; with exactly 1 ID (= INSZ/NISS number in 11 positions):)
kmehr.assert.P2.19 = /kmehrmessage/folder/patient;1;1
kmehr.assert.P2.20 = /kmehrmessage/folder/patient/id;1;1
kmehr.assert.P2.21 = /kmehrmessage/folder/patient/id[@S='ID-PATIENT' and @SV='1.0' and (string-length(text())=11)];1;1

##(:Patient: presence of firstname; familyname; sex and birthdate:)
kmehr.assert.P2.22 = /kmehrmessage/folder/patient/firstname;1;1
kmehr.assert.P2.23 = /kmehrmessage/folder/patient/familyname;1;1
kmehr.assert.P2.24 = /kmehrmessage/folder/patient/birthdate/date;1;1
kmehr.assert.P2.25 = /kmehrmessage/folder/patient/sex/cd[@S='CD-SEX' and @SV='1.1'];1;1

##(:Transaction: Exactly 1 transaction; with 1 ID and 1 CD (CD-TRANSACTION with value pharmaceuticalprescription):)
kmehr.assert.P2.26 = /kmehrmessage/folder/transaction/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P2.27 = /kmehrmessage/folder/transaction/cd[@S='CD-TRANSACTION' and @SV='1.9' and text()='pharmaceuticalprescription'];1;1

##(:Author: Exactly 1 hcparty; with 1 ID (in 11 positions; starting with 1; 3 or 4) and 1 CD-HCPARTY (only allowed prescribers):)
kmehr.assert.P2.28 = /kmehrmessage/folder/transaction/author/hcparty;1;1
kmehr.assert.P2.29 = /kmehrmessage/folder/transaction/author/hcparty/id;1;1
kmehr.assert.P2.30 = /kmehrmessage/folder/transaction/author/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and string-length(text())=11];1;1
kmehr.assert.P2.31 = /kmehrmessage/folder/transaction/author/hcparty/cd;1;1
kmehr.assert.P2.32 = /kmehrmessage/folder/transaction/author/hcparty/cd[@S='CD-HCPARTY' and @SV= '1.9' and (text()='persphysician' or text()='persmidwife' or text()='persdentist')];1;1

#(:Author: presence of name or combination firstname + familyname; presence of address; presence of telephone number:)
kmehr.assert.P2.33 = /kmehrmessage/folder/transaction/author/hcparty[name or familyname];1
kmehr.assert.P2.34 = /kmehrmessage/folder/transaction/author/hcparty/address;1;1
kmehr.assert.P2.35 = /kmehrmessage/folder/transaction/author/hcparty/address/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P2.36 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P2.37 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-TELECOM' and @SV='1.0' and text()='phone'];1;1
kmehr.assert.P2.38 = /kmehrmessage/folder/transaction/author/hcparty/telecom/telecomnumber[string-length(text())>1];1;1

#(:Transaction: "iscomplete" and "isvalidated" are both true; no expirationdate should be defined:)
kmehr.assert.P2.39 = /kmehrmessage/folder/transaction/iscomplete[text()='true'];1;1
kmehr.assert.P2.40 = /kmehrmessage/folder/transaction/isvalidated[text()='true'];1;1
kmehr.assert.P2.41 = /kmehrmessage/folder/transaction/expirationdate;0;0

#(:Transaction: contains exactly 1 heading; and cannot contain any items:)
kmehr.assert.P2.42 = /kmehrmessage/folder/transaction/heading;1;1
kmehr.assert.P2.43 = /kmehrmessage/folder/transaction/item;0;0

#(:Heading: exactly 1 ID and 1 CD (CD-HEADING) with value 'prescription':)
kmehr.assert.P2.44 = /kmehrmessage/folder/transaction/heading/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P2.45 = /kmehrmessage/folder/transaction/heading/cd[@S='CD-HEADING' and @SV='1.2' and text()='prescription'];1;1

#(:Heading: cannot contain any other headings or text:)
kmehr.assert.P2.46 = /kmehrmessage/folder/transaction/heading/heading;0;0
kmehr.assert.P2.47 = /kmehrmessage/folder/transaction/heading/text;0;0

#(:Items: at least 1 and no more than 10; with correct ID en CD specifications:)
kmehr.assert.P2.48 = /kmehrmessage/folder/transaction/heading/item;1;10
kmehr.assert.P2.49 = /kmehrmessage/folder/transaction/heading/item/id[@S!='ID-KMEHR'];0;0
kmehr.assert.P2.50 = /kmehrmessage/folder/transaction/heading/item/id[@SV!='1.0'];0;0
kmehr.assert.P2.51 = /kmehrmessage/folder/transaction/heading/item/cd[@S!='CD-ITEM'];0;0
kmehr.assert.P2.52 = /kmehrmessage/folder/transaction/heading/item/cd[@SV!='1.9'];0;0
kmehr.assert.P2.53 = /kmehrmessage/folder/transaction/heading/item/cd[text()!='medication'];0;0

#(:Content: only once per item:)
## kmehr.assert.P2.66 = count(/kmehrmessage/folder/transaction/heading/item/content)=count(/kmehrmessage/folder/transaction/heading/item);1;1

#(:Medicinalproduct: should always contain intendedcd (CNK). In case no CNK is known; intendedcd equals '0000000'. SV attribute is WSSAMv2 (in case the webservice SAMv2 is used); otherwise it defaults to LOCALDB:)
kmehr.assert.P2.54 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@S!='CD-DRUG-CNK'];0;0
kmehr.assert.P2.60 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and @SV!='WSSAMv2'];0;0

#(:Medicinalproduct: if value of intendedcd (CNK) equals '0000000' (default value when no CNK is known); SV attribute always equals 'LOCALDB':)
kmehr.assert.P2.55 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and text()='0000000'];0;0

#(:Medicinalproduct: intendedname cannot be empty (a product name should always be provided):)
kmehr.assert.P2.56 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct (INN): correct use of attributes and intendedname should not be empty (a cluster description/name should always be provided):)
kmehr.assert.P2.57 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@S!='CD-INNCLUSTER'];0;0
kmehr.assert.P2.58 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@SV!='LOCALDB'];0;0
kmehr.assert.P2.59 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct: If substancecode/cd element contains the cluster code; duration should be specified; in order to let the pharmacist choose the correct package size for the intended treatment duration. In case the INN prescription is provided as text (value cd='0000000'; duration is optional:)
#(:Desactivated at 27/01/2017 based on feedback
kmehr.assert.P2.1.60 = count(kmehrmessage/folder/transaction/heading/item[(content/substanceproduct/intendedcd[text()!='0000000'])]/duration)
kmehr.assert.P2.2.60 = count(kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[text()!='0000000'])

#(:Compoundprescription: Formularyreference: at least 1 cd; including S attribute =CD-FORMULARYREFERENCE should be present:)
kmehr.assert.P2.1.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference/cd[@S='CD-FORMULARYREFERENCE' and @SV='1.0' and (@L='fr' or @L='nl') and (string-length(@DN)!=0) and (string-length(text())!=0) and (string-length(text())=7) and starts-with(text(),'05')])
kmehr.assert.P2.2.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference)

#(:Lifecycle: every item should contain a lifecycle element with cd and corresponding attributes. cd value = prescribed:)
kmehr.assert.P2.1.62 = count(/kmehrmessage/folder/transaction/heading/item/lifecycle/cd[@S='CD-LIFECYCLE' and @SV='1.7' and text()='prescribed'])
kmehr.assert.P2.2.62 = count(/kmehrmessage/folder/transaction/heading/item)

#(:Temporality: optional; but if present; correct usage of S and SV attributes:)
kmehr.assert.P2.63 = /kmehrmessage/folder/transaction/heading/item/temporality/cd[not (@S='CD-TEMPORALITY') or not(@SV='1.0')];0;0

#(:Quantity: if prescription contains a medicinalproduct or compoundprescription; quantity should be specified:)
kmehr.assert.P2.1.64 = count(/kmehrmessage/folder/transaction/heading/item[(content/compoundprescription)]/quantity)
kmehr.assert.P2.2.64 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription)
kmehr.assert.P2.1.65 = count(/kmehrmessage/folder/transaction/heading/item[(content/medicinalproduct)]/quantity)
kmehr.assert.P2.2.65 = count(/kmehrmessage/folder/transaction/heading/item/content/medicinalproduct)

#(:Quantity: If substancecode/cd element contains the cluster code; no quantity should be present (duration should be specified):)
kmehr.assert.P2.66 = /kmehrmessage/folder/transaction/heading/item[(quantity)]/content/substanceproduct/intendedcd[text()!='0000000'];0;0

#(:Posology: posology is a mandatory element; and should be encoded as text (it should exactly correspond to the posology as printed on the proof of electronic prescription). Supplementary a regimen can be specified according to Vitalink-specifications. In case a posology is not relevant; please use the string 'niet van toepassing' or 'pas d'application'. In case the posology is known by the patient (en thus there is no need to further specify it); please use the string 'usage connu' or 'gebruik gekend'.:)
kmehr.assert.P2.1.67 = count(/kmehrmessage/folder/transaction/heading/item/posology/text)
kmehr.assert.P2.2.67 = count(/kmehrmessage/folder/transaction/heading/item)
kmehr.assert.P2.68 = /kmehrmessage/folder/transaction/heading/item/posology/text[string-length(text())=0];0;0

#(:Vitalink Medication scheme rule:  Beginmoment should be present for every item::)
kmehr.assert.P2.1.69 = count(/kmehrmessage/folder/transaction/heading/item/beginmoment/date)
kmehr.assert.P2.2.69 = count(/kmehrmessage/folder/transaction/heading/item)
#(:Vitalink Medication scheme rule:  Frequency (optional); can only contain periodicity; with correct SV attribute (1.1); and cannot contain following values: UQ; US; UN; UX en UE:)
kmehr.assert.P2.70 = /kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[text()='UQ' or text()='US' or text()='UN' or text()='UX' or text()='UE'];0;0
kmehr.assert.P2.1.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[@S='CD-PERIODICITY' and @SV='1.1'])
kmehr.assert.P2.2.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency)
#######################################################################################################################
######################    P3   ########################################################################################
#######################################################################################################################
##(:Kmehr versions supported: 1.17.1 (20160601):)
kmehr.assert.P3.1 = /kmehrmessage/header/standard/cd[@S='CD-STANDARD' and @SV='1.18' and (text()='20160601')];1;1

##(:2 header IDs must be present: first one with "S" attribute = ID-KMEHR; the second one with "S" attribute = LOCAL:)
kmehr.assert.P3.2 = /kmehrmessage/header/id;2
kmehr.assert.P3.3 = /kmehrmessage/header/id[1][@S='ID-KMEHR' and @SV='1.0'];1
kmehr.assert.P3.4 = /kmehrmessage/header/id[2][@S='LOCAL'];1

##(:Sender: At least 2 hcparty's: individual healthcareprovider (or hospital) and "application" (softwareprovider). Name or combination firstname + familyname should always be present:)
kmehr.assert.P3.5 = /kmehrmessage/header/sender/hcparty;2
kmehr.assert.P3.6 = /kmehrmessage/header/sender/hcparty/id[@S='ID-HCPARTY' and @SV='1.0'];1
kmehr.assert.P3.7 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and (text()='orghospital' or text()='persphysician' or text()='persmidwife' or text()='persdentist')];1
kmehr.assert.P3.8 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='application'];1
kmehr.assert.P3.9 = /kmehrmessage/header/sender/hcparty[name or familyname];1

##(:For sender "application"; both telephone and email need to be present; and cannot be empty:)
kmehr.assert.P3.10 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-ADDRESS' and @SV='1.1']/text();2
kmehr.assert.P3.11 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and @SV='1.0']/text();2
kmehr.assert.P3.12 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='phone'];1
kmehr.assert.P3.13 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='email'];1
kmehr.assert.P3.14 = /kmehrmessage/header/sender/hcparty[2]/telecom/telecomnumber[string-length(text())!=0];1

##(:Recipient: only 1 hcparty with recipe data:)
kmehr.assert.P3.15 = /kmehrmessage/header/recipient/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and text()='RECIPE'];1;1
kmehr.assert.P3.16 = /kmehrmessage/header/recipient/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='orgpublichealth'];1;1
kmehr.assert.P3.17 = /kmehrmessage/header/recipient/hcparty/name[text()='Recip-e'];1;1

##(:Folder: exactly 1 folder; with exactly 1 ID; with value "1":)
kmehr.assert.P3.18 = /kmehrmessage/folder/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1

##(:Patient: exactly 1 patient; with exactly 1 ID (= INSZ/NISS number in 11 positions):)
kmehr.assert.P3.19 = /kmehrmessage/folder/patient;1;1
kmehr.assert.P3.20 = /kmehrmessage/folder/patient/id;1;1
kmehr.assert.P3.21 = /kmehrmessage/folder/patient/id[@S='ID-PATIENT' and @SV='1.0' and (string-length(text())=11)];1;1

##(:Patient: presence of firstname; familyname; sex and birthdate:)
kmehr.assert.P3.22 = /kmehrmessage/folder/patient/firstname;1;1
kmehr.assert.P3.23 = /kmehrmessage/folder/patient/familyname;1;1
kmehr.assert.P3.24 = /kmehrmessage/folder/patient/birthdate/date;1;1
kmehr.assert.P3.25 = /kmehrmessage/folder/patient/sex/cd[@S='CD-SEX' and @SV='1.1'];1;1

##(:Transaction: Exactly 1 transaction; with 1 ID and 1 CD (CD-TRANSACTION with value pharmaceuticalprescription):)
kmehr.assert.P3.26 = /kmehrmessage/folder/transaction/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P3.27 = /kmehrmessage/folder/transaction/cd[@S='CD-TRANSACTION' and @SV='1.9' and text()='pharmaceuticalprescription'];1;1

##(:Author: Exactly 1 hcparty; with 1 ID (in 11 positions; starting with 1; 3 or 4) and 1 CD-HCPARTY (only allowed prescribers):)
kmehr.assert.P3.28 = /kmehrmessage/folder/transaction/author/hcparty;1;1
kmehr.assert.P3.29 = /kmehrmessage/folder/transaction/author/hcparty/id;1;1
kmehr.assert.P3.30 = /kmehrmessage/folder/transaction/author/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and string-length(text())=11];1;1
kmehr.assert.P3.31 = /kmehrmessage/folder/transaction/author/hcparty/cd;1;1
kmehr.assert.P3.32 = /kmehrmessage/folder/transaction/author/hcparty/cd[@S='CD-HCPARTY' and @SV= '1.9' and (text()='persphysician' or text()='persmidwife' or text()='persdentist')];1;1

#(:Author: presence of name or combination firstname + familyname; presence of address; presence of telephone number:)
kmehr.assert.P3.33 = /kmehrmessage/folder/transaction/author/hcparty[name or familyname];1
kmehr.assert.P3.34 = /kmehrmessage/folder/transaction/author/hcparty/address;1;1
kmehr.assert.P3.35 = /kmehrmessage/folder/transaction/author/hcparty/address/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P3.36 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P3.37 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-TELECOM' and @SV='1.0' and text()='phone'];1;1
kmehr.assert.P3.38 = /kmehrmessage/folder/transaction/author/hcparty/telecom/telecomnumber[string-length(text())>1];1;1

#(:Transaction: "iscomplete" and "isvalidated" are both true; no expirationdate should be defined:)
kmehr.assert.P3.39 = /kmehrmessage/folder/transaction/iscomplete[text()='true'];1;1
kmehr.assert.P3.40 = /kmehrmessage/folder/transaction/isvalidated[text()='true'];1;1
kmehr.assert.P3.41 = /kmehrmessage/folder/transaction/expirationdate;0;0

#(:Transaction: contains exactly 1 heading; and cannot contain any items:)
kmehr.assert.P3.42 = /kmehrmessage/folder/transaction/heading;1;1
kmehr.assert.P3.43 = /kmehrmessage/folder/transaction/item;0;0

#(:Heading: exactly 1 ID and 1 CD (CD-HEADING) with value 'prescription':)
kmehr.assert.P3.44 = /kmehrmessage/folder/transaction/heading/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P3.45 = /kmehrmessage/folder/transaction/heading/cd[@S='CD-HEADING' and @SV='1.2' and text()='prescription'];1;1

#(:Heading: cannot contain any other headings or text:)
kmehr.assert.P3.46 = /kmehrmessage/folder/transaction/heading/heading;0;0
kmehr.assert.P3.47 = /kmehrmessage/folder/transaction/heading/text;0;0

#(:Items: at least 1 and no more than 10; with correct ID en CD specifications:)
kmehr.assert.P3.48 = /kmehrmessage/folder/transaction/heading/item;1;10
kmehr.assert.P3.49 = /kmehrmessage/folder/transaction/heading/item/id[@S!='ID-KMEHR'];0;0
kmehr.assert.P3.50 = /kmehrmessage/folder/transaction/heading/item/id[@SV!='1.0'];0;0
kmehr.assert.P3.51 = /kmehrmessage/folder/transaction/heading/item/cd[@S!='CD-ITEM'];0;0
kmehr.assert.P3.52 = /kmehrmessage/folder/transaction/heading/item/cd[@SV!='1.9'];0;0
kmehr.assert.P3.53 = /kmehrmessage/folder/transaction/heading/item/cd[text()!='medication'];0;0

#(:Content: only once per item:)
## kmehr.assert.P3.66 = count(/kmehrmessage/folder/transaction/heading/item/content)=count(/kmehrmessage/folder/transaction/heading/item);1;1

#(:Medicinalproduct: should always contain intendedcd (CNK). In case no CNK is known; intendedcd equals '0000000'. SV attribute is WSSAMv2 (in case the webservice SAMv2 is used); otherwise it defaults to LOCALDB:)
kmehr.assert.P3.54 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@S!='CD-DRUG-CNK'];0;0
kmehr.assert.P3.60 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and @SV!='WSSAMv2'];0;0

#(:Medicinalproduct: if value of intendedcd (CNK) equals '0000000' (default value when no CNK is known); SV attribute always equals 'LOCALDB':)
kmehr.assert.P3.55 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and text()='0000000'];0;0

#(:Medicinalproduct: intendedname cannot be empty (a product name should always be provided):)
kmehr.assert.P3.56 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct (INN): correct use of attributes and intendedname should not be empty (a cluster description/name should always be provided):)
kmehr.assert.P3.57 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@S!='CD-INNCLUSTER'];0;0
kmehr.assert.P3.58 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@SV!='LOCALDB'];0;0
kmehr.assert.P3.59 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct: If substancecode/cd element contains the cluster code; duration should be specified; in order to let the pharmacist choose the correct package size for the intended treatment duration. In case the INN prescription is provided as text (value cd='0000000'; duration is optional:)
#(:Desactivated at 27/01/2017 based on feedback
kmehr.assert.P3.1.60 = count(kmehrmessage/folder/transaction/heading/item[(content/substanceproduct/intendedcd[text()!='0000000'])]/duration)
kmehr.assert.P3.2.60 = count(kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[text()!='0000000'])

#(:Compoundprescription: Formularyreference: at least 1 cd; including S attribute =CD-FORMULARYREFERENCE should be present:)
kmehr.assert.P3.1.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference/cd[@S='CD-FORMULARYREFERENCE' and @SV='1.0' and (@L='fr' or @L='nl') and (string-length(@DN)!=0) and (string-length(text())!=0) and (string-length(text())=7) and starts-with(text(),'05')])
kmehr.assert.P3.2.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference)

#(:Lifecycle: every item should contain a lifecycle element with cd and corresponding attributes. cd value = prescribed:)
kmehr.assert.P3.1.62 = count(/kmehrmessage/folder/transaction/heading/item/lifecycle/cd[@S='CD-LIFECYCLE' and @SV='1.7' and text()='prescribed'])
kmehr.assert.P3.2.62 = count(/kmehrmessage/folder/transaction/heading/item)

#(:Temporality: optional; but if present; correct usage of S and SV attributes:)
kmehr.assert.P3.63 = /kmehrmessage/folder/transaction/heading/item/temporality/cd[not (@S='CD-TEMPORALITY') or not(@SV='1.0')];0;0

#(:Quantity: if prescription contains a medicinalproduct or compoundprescription; quantity should be specified:)
kmehr.assert.P3.1.64 = count(/kmehrmessage/folder/transaction/heading/item[(content/compoundprescription)]/quantity)
kmehr.assert.P3.2.64 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription)
kmehr.assert.P3.1.65 = count(/kmehrmessage/folder/transaction/heading/item[(content/medicinalproduct)]/quantity)
kmehr.assert.P3.2.65 = count(/kmehrmessage/folder/transaction/heading/item/content/medicinalproduct)

#(:Quantity: If substancecode/cd element contains the cluster code; no quantity should be present (duration should be specified):)
kmehr.assert.P3.66 = /kmehrmessage/folder/transaction/heading/item[(quantity)]/content/substanceproduct/intendedcd[text()!='0000000'];0;0

#(:Posology: posology is a mandatory element; and should be encoded as text (it should exactly correspond to the posology as printed on the proof of electronic prescription). Supplementary a regimen can be specified according to Vitalink-specifications. In case a posology is not relevant; please use the string 'niet van toepassing' or 'pas d'application'. In case the posology is known by the patient (en thus there is no need to further specify it); please use the string 'usage connu' or 'gebruik gekend'.:)
kmehr.assert.P3.1.67 = count(/kmehrmessage/folder/transaction/heading/item/posology/text)
kmehr.assert.P3.2.67 = count(/kmehrmessage/folder/transaction/heading/item)
kmehr.assert.P3.68 = /kmehrmessage/folder/transaction/heading/item/posology/text[string-length(text())=0];0;0

#(:Vitalink Medication scheme rule:  Beginmoment should be present for every item::)
kmehr.assert.P3.1.69 = count(/kmehrmessage/folder/transaction/heading/item/beginmoment/date)
kmehr.assert.P3.2.69 = count(/kmehrmessage/folder/transaction/heading/item)
#(:Vitalink Medication scheme rule:  Frequency (optional); can only contain periodicity; with correct SV attribute (1.1); and cannot contain following values: UQ; US; UN; UX en UE:)
kmehr.assert.P3.70 = /kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[text()='UQ' or text()='US' or text()='UN' or text()='UX' or text()='UE'];0;0
kmehr.assert.P3.1.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[@S='CD-PERIODICITY' and @SV='1.1'])
kmehr.assert.P3.2.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency)
#######################################################################################################################
######################    P4   ########################################################################################
#######################################################################################################################
##(:Kmehr versions supported: 1.17.1 (20160601):)
kmehr.assert.P4.1 = /kmehrmessage/header/standard/cd[@S='CD-STANDARD' and @SV='1.18' and (text()='20160601')];1;1

##(:2 header IDs must be present: first one with "S" attribute = ID-KMEHR; the second one with "S" attribute = LOCAL:)
kmehr.assert.P4.2 = /kmehrmessage/header/id;2
kmehr.assert.P4.3 = /kmehrmessage/header/id[1][@S='ID-KMEHR' and @SV='1.0'];1
kmehr.assert.P4.4 = /kmehrmessage/header/id[2][@S='LOCAL'];1

##(:Sender: At least 2 hcparty's: individual healthcareprovider (or hospital) and "application" (softwareprovider). Name or combination firstname + familyname should always be present:)
kmehr.assert.P4.5 = /kmehrmessage/header/sender/hcparty;2
kmehr.assert.P4.6 = /kmehrmessage/header/sender/hcparty/id[@S='ID-HCPARTY' and @SV='1.0'];1
kmehr.assert.P4.7 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and (text()='orghospital' or text()='persphysician' or text()='persmidwife' or text()='persdentist')];1
kmehr.assert.P4.8 = /kmehrmessage/header/sender/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='application'];1
kmehr.assert.P4.9 = /kmehrmessage/header/sender/hcparty[name or familyname];1

##(:For sender "application"; both telephone and email need to be present; and cannot be empty:)
kmehr.assert.P4.10 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-ADDRESS' and @SV='1.1']/text();2
kmehr.assert.P4.11 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and @SV='1.0']/text();2
kmehr.assert.P4.12 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='phone'];1
kmehr.assert.P4.13 = /kmehrmessage/header/sender/hcparty[2]/telecom/cd[@S='CD-TELECOM' and text()='email'];1
kmehr.assert.P4.14 = /kmehrmessage/header/sender/hcparty[2]/telecom/telecomnumber[string-length(text())!=0];1

##(:Recipient: only 1 hcparty with recipe data:)
kmehr.assert.P4.15 = /kmehrmessage/header/recipient/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and text()='RECIPE'];1;1
kmehr.assert.P4.16 = /kmehrmessage/header/recipient/hcparty/cd[@S='CD-HCPARTY' and @SV='1.9' and text()='orgpublichealth'];1;1
kmehr.assert.P4.17 = /kmehrmessage/header/recipient/hcparty/name[text()='Recip-e'];1;1

##(:Folder: exactly 1 folder; with exactly 1 ID; with value "1":)
kmehr.assert.P4.18 = /kmehrmessage/folder/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1

##(:Patient: exactly 1 patient; with exactly 1 ID (= INSZ/NISS number in 11 positions):)
kmehr.assert.P4.19 = /kmehrmessage/folder/patient;1;1
kmehr.assert.P4.20 = /kmehrmessage/folder/patient/id;1;1
kmehr.assert.P4.21 = /kmehrmessage/folder/patient/id[@S='ID-PATIENT' and @SV='1.0' and (string-length(text())=11)];1;1

##(:Patient: presence of firstname; familyname; sex and birthdate:)
kmehr.assert.P4.22 = /kmehrmessage/folder/patient/firstname;1;1
kmehr.assert.P4.23 = /kmehrmessage/folder/patient/familyname;1;1
kmehr.assert.P4.24 = /kmehrmessage/folder/patient/birthdate/date;1;1
kmehr.assert.P4.25 = /kmehrmessage/folder/patient/sex/cd[@S='CD-SEX' and @SV='1.1'];1;1

##(:Transaction: Exactly 1 transaction; with 1 ID and 1 CD (CD-TRANSACTION with value pharmaceuticalprescription):)
kmehr.assert.P4.26 = /kmehrmessage/folder/transaction/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P4.27 = /kmehrmessage/folder/transaction/cd[@S='CD-TRANSACTION' and @SV='1.9' and text()='pharmaceuticalprescription'];1;1

##(:Author: Exactly 1 hcparty; with 1 ID (in 11 positions; starting with 1; 3 or 4) and 1 CD-HCPARTY (only allowed prescribers):)
kmehr.assert.P4.28 = /kmehrmessage/folder/transaction/author/hcparty;1;1
kmehr.assert.P4.29 = /kmehrmessage/folder/transaction/author/hcparty/id;1;1
kmehr.assert.P4.30 = /kmehrmessage/folder/transaction/author/hcparty/id[@S='ID-HCPARTY' and @SV='1.0' and string-length(text())=11];1;1
kmehr.assert.P4.31 = /kmehrmessage/folder/transaction/author/hcparty/cd;1;1
kmehr.assert.P4.32 = /kmehrmessage/folder/transaction/author/hcparty/cd[@S='CD-HCPARTY' and @SV= '1.9' and (text()='persphysician' or text()='persmidwife' or text()='persdentist')];1;1

#(:Author: presence of name or combination firstname + familyname; presence of address; presence of telephone number:)
kmehr.assert.P4.33 = /kmehrmessage/folder/transaction/author/hcparty[name or familyname];1
kmehr.assert.P4.34 = /kmehrmessage/folder/transaction/author/hcparty/address;1;1
kmehr.assert.P4.35 = /kmehrmessage/folder/transaction/author/hcparty/address/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P4.36 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-ADDRESS' and (@SV='1.0' or @SV='1.1') and text()='work'];1;1
kmehr.assert.P4.37 = /kmehrmessage/folder/transaction/author/hcparty/telecom/cd[@S='CD-TELECOM' and @SV='1.0' and text()='phone'];1;1
kmehr.assert.P4.38 = /kmehrmessage/folder/transaction/author/hcparty/telecom/telecomnumber[string-length(text())>1];1;1

#(:Transaction: "iscomplete" and "isvalidated" are both true; no expirationdate should be defined:)
kmehr.assert.P4.39 = /kmehrmessage/folder/transaction/iscomplete[text()='true'];1;1
kmehr.assert.P4.40 = /kmehrmessage/folder/transaction/isvalidated[text()='true'];1;1
kmehr.assert.P4.41 = /kmehrmessage/folder/transaction/expirationdate;0;0

#(:Transaction: contains exactly 1 heading; and cannot contain any items:)
kmehr.assert.P4.42 = /kmehrmessage/folder/transaction/heading;1;1
kmehr.assert.P4.43 = /kmehrmessage/folder/transaction/item;0;0

#(:Heading: exactly 1 ID and 1 CD (CD-HEADING) with value 'prescription':)
kmehr.assert.P4.44 = /kmehrmessage/folder/transaction/heading/id[@S='ID-KMEHR' and @SV='1.0' and text()='1'];1;1
kmehr.assert.P4.45 = /kmehrmessage/folder/transaction/heading/cd[@S='CD-HEADING' and @SV='1.2' and text()='prescription'];1;1

#(:Heading: cannot contain any other headings or text:)
kmehr.assert.P4.46 = /kmehrmessage/folder/transaction/heading/heading;0;0
kmehr.assert.P4.47 = /kmehrmessage/folder/transaction/heading/text;0;0

#(:Items: at least 1 and no more than 10; with correct ID en CD specifications:)
kmehr.assert.P4.48 = /kmehrmessage/folder/transaction/heading/item;1;10
kmehr.assert.P4.49 = /kmehrmessage/folder/transaction/heading/item/id[@S!='ID-KMEHR'];0;0
kmehr.assert.P4.50 = /kmehrmessage/folder/transaction/heading/item/id[@SV!='1.0'];0;0
kmehr.assert.P4.51 = /kmehrmessage/folder/transaction/heading/item/cd[@S!='CD-ITEM'];0;0
kmehr.assert.P4.52 = /kmehrmessage/folder/transaction/heading/item/cd[@SV!='1.9'];0;0
kmehr.assert.P4.53 = /kmehrmessage/folder/transaction/heading/item/cd[text()!='medication'];0;0

#(:Content: only once per item:)
## kmehr.assert.P4.66 = count(/kmehrmessage/folder/transaction/heading/item/content)=count(/kmehrmessage/folder/transaction/heading/item);1;1

#(:Medicinalproduct: should always contain intendedcd (CNK). In case no CNK is known; intendedcd equals '0000000'. SV attribute is WSSAMv2 (in case the webservice SAMv2 is used); otherwise it defaults to LOCALDB:)
kmehr.assert.P4.54 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@S!='CD-DRUG-CNK'];0;0
kmehr.assert.P4.60 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and @SV!='WSSAMv2'];0;0

#(:Medicinalproduct: if value of intendedcd (CNK) equals '0000000' (default value when no CNK is known); SV attribute always equals 'LOCALDB':)
kmehr.assert.P4.55 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedcd[@SV!='LOCALDB' and text()='0000000'];0;0

#(:Medicinalproduct: intendedname cannot be empty (a product name should always be provided):)
kmehr.assert.P4.56 = /kmehrmessage/folder/transaction/heading/item/content/medicinalproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct (INN): correct use of attributes and intendedname should not be empty (a cluster description/name should always be provided):)
kmehr.assert.P4.57 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@S!='CD-INNCLUSTER'];0;0
kmehr.assert.P4.58 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[@SV!='LOCALDB'];0;0
kmehr.assert.P4.59 = /kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedname[string-length (text())=0];0;0

#(:Substanceproduct: If substancecode/cd element contains the cluster code; duration should be specified; in order to let the pharmacist choose the correct package size for the intended treatment duration. In case the INN prescription is provided as text (value cd='0000000'; duration is optional:)
#(:Desactivated at 27/01/2017 based on feedback
kmehr.assert.P4.1.60 = count(kmehrmessage/folder/transaction/heading/item[(content/substanceproduct/intendedcd[text()!='0000000'])]/duration)
kmehr.assert.P4.2.60 = count(kmehrmessage/folder/transaction/heading/item/content/substanceproduct/intendedcd[text()!='0000000'])

#(:Compoundprescription: Formularyreference: at least 1 cd; including S attribute =CD-FORMULARYREFERENCE should be present:)
kmehr.assert.P4.1.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference/cd[@S='CD-FORMULARYREFERENCE' and @SV='1.0' and (@L='fr' or @L='nl') and (string-length(@DN)!=0) and (string-length(text())!=0) and (string-length(text())=7) and starts-with(text(),'05')])
kmehr.assert.P4.2.61 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription/formularyreference)

#(:Lifecycle: every item should contain a lifecycle element with cd and corresponding attributes. cd value = prescribed:)
kmehr.assert.P4.1.62 = count(/kmehrmessage/folder/transaction/heading/item/lifecycle/cd[@S='CD-LIFECYCLE' and @SV='1.7' and text()='prescribed'])
kmehr.assert.P4.2.62 = count(/kmehrmessage/folder/transaction/heading/item)

#(:Temporality: optional; but if present; correct usage of S and SV attributes:)
kmehr.assert.P4.63 = /kmehrmessage/folder/transaction/heading/item/temporality/cd[not (@S='CD-TEMPORALITY') or not(@SV='1.0')];0;0

#(:Quantity: if prescription contains a medicinalproduct or compoundprescription; quantity should be specified:)
kmehr.assert.P4.1.64 = count(/kmehrmessage/folder/transaction/heading/item[(content/compoundprescription)]/quantity)
kmehr.assert.P4.2.64 = count(/kmehrmessage/folder/transaction/heading/item/content/compoundprescription)
kmehr.assert.P4.1.65 = count(/kmehrmessage/folder/transaction/heading/item[(content/medicinalproduct)]/quantity)
kmehr.assert.P4.2.65 = count(/kmehrmessage/folder/transaction/heading/item/content/medicinalproduct)

#(:Quantity: If substancecode/cd element contains the cluster code; no quantity should be present (duration should be specified):)
kmehr.assert.P4.66 = /kmehrmessage/folder/transaction/heading/item[(quantity)]/content/substanceproduct/intendedcd[text()!='0000000'];0;0

#(:Posology: posology is a mandatory element; and should be encoded as text (it should exactly correspond to the posology as printed on the proof of electronic prescription). Supplementary a regimen can be specified according to Vitalink-specifications. In case a posology is not relevant; please use the string 'niet van toepassing' or 'pas d'application'. In case the posology is known by the patient (en thus there is no need to further specify it); please use the string 'usage connu' or 'gebruik gekend'.:)
kmehr.assert.P4.1.67 = count(/kmehrmessage/folder/transaction/heading/item/posology/text)
kmehr.assert.P4.2.67 = count(/kmehrmessage/folder/transaction/heading/item)
kmehr.assert.P4.68 = /kmehrmessage/folder/transaction/heading/item/posology/text[string-length(text())=0];0;0

#(:Vitalink Medication scheme rule:  Beginmoment should be present for every item::)
kmehr.assert.P4.1.69 = count(/kmehrmessage/folder/transaction/heading/item/beginmoment/date)
kmehr.assert.P4.2.69 = count(/kmehrmessage/folder/transaction/heading/item)
#(:Vitalink Medication scheme rule:  Frequency (optional); can only contain periodicity; with correct SV attribute (1.1); and cannot contain following values: UQ; US; UN; UX en UE:)
kmehr.assert.P4.70 = /kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[text()='UQ' or text()='US' or text()='UN' or text()='UX' or text()='UE'];0;0
kmehr.assert.P4.1.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency/periodicity/cd[@S='CD-PERIODICITY' and @SV='1.1'])
kmehr.assert.P4.2.71 = count(/kmehrmessage/folder/transaction/heading/item/frequency)